<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Mittelalter-Dorf</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="startScreen">
    <h2>Dorf gr√ºnden</h2>
    <input id="villageNameInput" placeholder="Dorfname eingeben" />

    <button id="startButton" type="button" onclick="window.startGame && window.startGame()">Starten</button>

    <div id="startError" class="error"></div>
  </div>

  <div id="header" class="hidden">
    <h1>Dorf: <span id="villageName"></span></h1>
    <div>Prestige: <span id="prestige">0</span></div>
    <div>Jahreszeit: <span id="seasonName"></span> (Wechsel in: <span id="seasonTimeLeft"></span>)</div>
  </div>

  <div id="gameArea" class="hidden">
    <div id="leftSide">
      <div id="resourcesPanel" class="panel">
        <strong>Ressourcen</strong><br>
        Holz: <span id="wood">0</span> / <span id="woodMax">1000</span><br>
        Nahrung: <span id="food">0</span> / <span id="foodMax">500</span><br>
        Stein: <span id="stone">0</span> / <span id="stoneMax">300</span><br>
        Gold: <span id="gold">0</span><br>
        Bev√∂lkerung: <span id="population">0</span> / <span id="populationCap">0</span><br>
        Zufriedenheit: <span id="villagerHappiness">0%</span><br>
        Gesundheit: <span id="villagerHealth">0%</span>
      </div>

      <div id="dashboard" class="dashboard">
        <h3>Ansichten</h3>
        <button onclick="setView('overview')">üìä √úbersicht</button>
        <button onclick="setView('woodcutter')">ü™ì Holzf√§llerlager</button>
        <button onclick="setView('farm')">üåæ Bauernhof</button>
        <button onclick="setView('quarry')">‚õèÔ∏è Steinbruch</button>
        <button onclick="setView('housing')">üè† Wohnh√§user</button>
        <button onclick="setView('market')">ü™ô Markt</button>
        <button onclick="setView('quests')">üìú Quests</button>
      </div>
    </div>

    <div id="mainPanels">
      <div id="overviewPanel" class="panel detailPanel">
        <h2>Produktions√ºbersicht</h2>
        Holz/s: <span id="ovWoodPerSecond">0</span><br>
        Nahrung/s: <span id="ovFoodPerSecond">0</span><br>
        Stein/s: <span id="ovStonePerSecond">0</span><br>
        Gold/s: <span id="ovGoldPerSecond">0</span><br>
        Netto Nahrung/s: <span id="ovFoodNetPerSecond">0</span><br><br>

        Holz: <span id="ovWood">0</span> / <span id="ovWoodMax">0</span><br>
        Nahrung: <span id="ovFood">0</span> / <span id="ovFoodMax">0</span><br>
        Stein: <span id="ovStone">0</span> / <span id="ovStoneMax">0</span><br>
        Gold: <span id="ovGold">0</span><br>
        Bev√∂lkerung: <span id="ovPopulation">0</span> / <span id="ovPopulationCap">0</span><br>

        <h3>Weltstatus</h3>
        <p id="eventInfo">Kein Ereignis aktiv</p>
        <p id="offlineInfo" class="small"></p>

        <h3>Prestige</h3>
        Wohlstand: <span id="ovWealth">0</span> / <span id="ovPrestigeTarget">0</span>
        <div class="progress"><div id="prestigeProgressBar" class="bar prestige"></div></div>
        <button id="btnPrestigeReset" onclick="doPrestigeReset()">Prestige-Reset durchf√ºhren</button>

        <p id="statusNotes"></p>
        <button onclick="manualSave()">Spiel speichern</button>
        <div id="saveInfo" class="small"></div>
      </div>

      <div id="woodcutterPanel" class="panel detailPanel hidden">
        <h2>Holzf√§llerlager</h2>
        Level: <span id="woodLevel"></span><br>
        Holz pro Abschluss: <span id="woodPerHit"></span><br>
        Fortschritt/s: <span id="workSpeed"></span><br>
        Holz/s: <span id="woodPerSecond"></span><br>
        <div class="progress"><div id="workBar" class="bar"></div></div>
        Kosten n√§chstes Level: <span id="woodLevelCost"></span> Gold<br>
        Effekt: <span id="woodLevelImpact"></span><br>
        <button onclick="upgradeWoodcutterLevel()">Level erh√∂hen</button>
        <h3>Upgrades</h3>
        <button onclick="buyWoodcutterUpgrade('sharpAxe')">Scharfe Axt (150 Gold)</button>
        <button onclick="buyWoodcutterUpgrade('secondWorker')">Zweiter Arbeiter (300 Gold)</button>
        <button onclick="buyWoodcutterUpgrade('mechanicalSaw')">Mechanische S√§ge (1000 Gold)</button>
      </div>

      <div id="farmPanel" class="panel detailPanel hidden">
        <h2>Bauernhof</h2>
        Level: <span id="farmLevel"></span><br>
        Nahrung pro Abschluss: <span id="farmPerHit"></span><br>
        Fortschritt/s: <span id="farmWorkSpeed"></span><br>
        Nahrung/s: <span id="farmFoodPerSecond"></span><br>
        Saison-Multiplikator: <span id="farmSeasonMult"></span><br>
        <div class="progress"><div id="farmBar" class="bar"></div></div>
        Kosten n√§chstes Level: <span id="farmLevelCost"></span> Gold<br>
        Effekt: <span id="farmLevelImpact"></span><br>
        <button onclick="upgradeFarmLevel()">Level erh√∂hen</button>
        <h3>Upgrades</h3>
        <button onclick="buyFarmUpgrade('betterPlow')">Besserer Pflug (200 Gold)</button>
        <button onclick="buyFarmUpgrade('betterSeeds')">Besseres Saatgut (350 Gold)</button>
        <button onclick="buyFarmUpgrade('secondFarmer')">Zweiter Bauer (800 Gold)</button>
      </div>

      <div id="quarryPanel" class="panel detailPanel hidden">
        <h2>Steinbruch</h2>
        Level: <span id="quarryLevel"></span><br>
        Stein pro Abschluss: <span id="stonePerHit"></span><br>
        Fortschritt/s: <span id="quarryWorkSpeed"></span><br>
        Stein/s: <span id="stonePerSecond"></span><br>
        Saison-Multiplikator: <span id="quarrySeasonMult"></span><br>
        <div class="progress"><div id="quarryBar" class="bar"></div></div>
        Kosten n√§chstes Level: <span id="quarryLevelCost"></span> Gold<br>
        Effekt: <span id="quarryLevelImpact"></span><br>
        <button onclick="upgradeQuarryLevel()">Level erh√∂hen</button>
        <h3>Upgrades</h3>
        <button onclick="buyQuarryUpgrade('ironTools')">Eisenwerkzeuge (280 Gold)</button>
        <button onclick="buyQuarryUpgrade('blastPowder')">Sprengpulver (+40%) (700 Gold)</button>
        <button onclick="buyQuarryUpgrade('crane')">Krananlage (1200 Gold)</button>
      </div>

      <div id="housingPanel" class="panel detailPanel hidden">
        <h2>Wohnh√§user</h2>
        Level: <span id="housingLevel"></span><br>
        Bev√∂lkerungsgrenze: <span id="housingCap"></span><br>
        Kosten n√§chstes Level: <span id="housingLevelCost"></span><br>
        <button onclick="upgradeHousingLevel()">Wohnh√§user ausbauen</button>

        <h3>Dorfbewohner & Arbeit</h3>
        Zugewiesene Arbeiter: <span id="workersAssigned">0</span><br>
        Freie Dorfbewohner: <span id="workersFree">0</span><br>
        Effizienz: <span id="workerEff">0%</span><br><br>

        <div class="workerRow">
          Holzf√§llerlager: <span id="workersWood">0</span>
          <button onclick="assignWorker('woodcutter', -1)">-</button>
          <button onclick="assignWorker('woodcutter', 1)">+</button>
        </div>
        <div class="workerRow">
          Bauernhof: <span id="workersFarm">0</span>
          <button onclick="assignWorker('farm', -1)">-</button>
          <button onclick="assignWorker('farm', 1)">+</button>
        </div>
        <div class="workerRow">
          Steinbruch: <span id="workersQuarry">0</span>
          <button onclick="assignWorker('quarry', -1)">-</button>
          <button onclick="assignWorker('quarry', 1)">+</button>
        </div>

        <h3>Upgrades</h3>
        <button onclick="buyHousingUpgrade('granary')">Speicherhaus (+10 Cap) (550G / 500H / 120S)</button>
        <button onclick="buyHousingUpgrade('infirmary')">Heilerhaus (+15 Cap) (900G / 400H / 250S)</button>
      </div>

      <div id="marketPanel" class="panel detailPanel hidden">
        <h2>Markt</h2>
        <p>Basispreise: Holz <span id="basePriceWood"></span>, Nahrung <span id="basePriceFood"></span>, Stein <span id="basePriceStone"></span></p>
        <p>Aktuelle Preise: Holz <span id="priceWood"></span>, Nahrung <span id="priceFood"></span>, Stein <span id="priceStone"></span></p>
        <p>Lebenszeit-Gold verdient: <span id="lifetimeGold"></span></p>

        <div class="marketRow">
          <strong>Holz</strong>
          <div>
            <button onclick="sellResource('wood', 10)">10 verkaufen</button>
            <button onclick="sellResource('wood', 100)">100 verkaufen</button>
            <button onclick="sellResource('wood', 'all')">Alles verkaufen</button>
            <button onclick="toggleAutoSell('wood')">Auto: <span id="autoWood">AUS</span></button>
          </div>
        </div>

        <div class="marketRow">
          <strong>Nahrung</strong>
          <div>
            <button onclick="sellResource('food', 10)">10 verkaufen</button>
            <button onclick="sellResource('food', 100)">100 verkaufen</button>
            <button onclick="sellResource('food', 'all')">Alles verkaufen</button>
            <button onclick="toggleAutoSell('food')">Auto: <span id="autoFood">AUS</span></button>
          </div>
        </div>

        <div class="marketRow">
          <strong>Stein</strong>
          <div>
            <button onclick="sellResource('stone', 10)">10 verkaufen</button>
            <button onclick="sellResource('stone', 100)">100 verkaufen</button>
            <button onclick="sellResource('stone', 'all')">Alles verkaufen</button>
            <button onclick="toggleAutoSell('stone')">Auto: <span id="autoStone">AUS</span></button>
          </div>
        </div>
      </div>

      <div id="questsPanel" class="panel detailPanel hidden">
        <h2>Quests & Meilensteine</h2>
        <div id="questsList"></div>
      </div>
    </div>
  </div>

  <script>
    (function setupStartFallback() {
      const btn = document.getElementById("startButton");
      const input = document.getElementById("villageNameInput");
      const error = document.getElementById("startError");

      function runStart() {
        if (typeof window.startGame === "function") {
          window.startGame();
          return;
        }

        if (error) {
          error.textContent = "Spielskript noch nicht geladen. Bitte Seite mit Strg+F5 neu laden.";
        }
      }

      if (btn) btn.addEventListener("click", runStart);
      if (input) {
        input.addEventListener("keydown", function (e) {
          if (e.key === "Enter") runStart();
        });
      }
    })();
  </script>

  <script type="module" src="main.js"></script>
</body>
</html>
